function BaseCrypto(b){var d=this,f=null,a=1,e=0,c=2;this.getLastError=function(){return f};this.isPluginInstalled=function(){switch(navigator.appName){case"Microsoft Internet Explorer":try{var l=new ActiveXObject("CAdESCOM.CPSigner");return true}catch(j){}break;default:if(navigator.userAgent.match(/Trident\/./i)){try{var h=new ActiveXObject("CAdESCOM.CPSigner");return true}catch(k){}}var g=navigator.mimeTypes["application/x-cades"];if(g){var i=g.enabledPlugin;if(i){return true}}}return false};this.parseSubject=function(k){var g={};var m=k.split(",");for(var j=0;j<m.length;j++){var l=m[j].trim().split("=");switch(l[0]){case"SN":g.lastName=l[1];break;case"G":var h=l[1].split(" ");g.firstName=h[0];if(l.length>1){g.middleName=h[1]}break;case"T":g.role=l[1];break;case"O":g.organization=l[1];break;case"OU":g.department=l[1];break;case"E":g.email=l[1];break;default:g[l[0]]=l[1]}}return g};this.dateToString=function(h){h=new Date(h);var i=h.getDate();var g=h.getMonth()+1;var j=h.getFullYear();return(i<=9?"0"+i:i)+"."+(g<=9?"0"+g:g)+"."+j};this.getCertificateList=function(){f=null;var m=d.openStore();if(!m){return false}try{var o=m.Certificates.Count,p=[],h}catch(l){reportJsError("Error getting cetrificates list from store: "+l);m.Close();return[]}for(var j=1;j<=o;j++){try{h=m.Certificates.Item(j)}catch(l){reportJsError("Error getting cetrificate ["+j+"] from store: "+l);f="CERTS_ERROR";return false}try{var n=this.parseSubject(h.SubjectName);var k=this.parseSubject(h.IssuerName);var g=n.CN+", ";if(n.organization){g+=n.organization+", "}if(k.organization){g+=k.organization+", "}g+=this.dateToString(h.ValidToDate);p.push({subjectName:g,thumbprint:h.Thumbprint,expirationDate:h.ValidToDate})}catch(l){reportJsError("Error adding cetrificate ["+h.SubjectName+"] to list: "+l);f="CERTS_ERROR";return false}}m.Close();return p};this.signData=function(s,i,j,l){f=null;if(!s){f="NO_CERT_CHOOSEN";return false}var o=d.openStore();if(!o){return false}var t=s.split(" ").reverse().join("").replace(/\s/g,"").toUpperCase();var k=0,u=o.Certificates.Find(k,t);if(u.Count==0){f="NO_CERTS";return false}var h=u.Item(1);var n=null;try{n=d.createObject("CAdESCOM.CPSigner")}catch(m){reportJsError("Error creating CAdESCOM.CPSigner: "+m);f="CREATE_SIGNER_ERROR";return false}if(!n){reportJsError("Error creating CAdESCOM.CPSigner (signer is null)");f="CREATE_SIGNER_ERROR";return false}n.Certificate=h;var g=new Date();if(h.ValidFromDate>g||h.ValidToDate<g){f="CERTIFICATE_OUT_OF_DATE";return false}var p=d.createObject("CAdESCOM.CadesSignedData");p.Content=j;n.Options=1;var r=a;if(i){r=e;n.TSAAddress=l}var q;try{q=p.SignCades(n,r)}catch(m){reportJsError("Error creating signature. signatureType is ["+r+"]: "+m);f="SIGN_ERROR";return false}o.Close();return q};this.openStore=function(){var h=false;f=null;try{h=d.createObject("CAPICOM.Store")}catch(g){reportJsError("Error creating CAPICOM.Store: "+g);f="STORE_INIT_ERROR";return false}try{h.Open(c)}catch(g){reportJsError("Error opening CAPICOM.Store: "+g);f="STORE_OPEN_ERROR";return false}return h};this.createObject=function(h){var g;switch(navigator.appName){case"Microsoft Internet Explorer":try{g=new ActiveXObject(h);break}catch(k){reportJsError("[IE] Error creating ["+h+"]: "+k);f="CREATE_OBJECT_ERROR"}default:var j=navigator.userAgent;if(j.match(/Trident\/./i)){try{return new ActiveXObject(h)}catch(k){reportJsError("[IE 11] Error creating ["+h+"]: "+k);f="CREATE_OBJECT_ERROR"}}if(j.match(/ipod/i)||j.match(/ipad/i)||j.match(/iphone/i)){try{return call_ru_cryptopro_npcades_10_native_bridge("CreateObject",[h])}catch(k){reportJsError("[IOS] Error creating ["+h+"]: "+k);f="CREATE_OBJECT_ERROR"}}try{var i=document.getElementById("cadesplugin");if(!i){reportJsError("[nonIE] Error creating ["+h+"] (cadesplugin is null): "+k)}g=i.CreateObject(h)}catch(k){reportJsError("[nonIE] Error creating "+h+": "+k);f="CREATE_OBJECT_ERROR"}}return g};d.getErrorMessage=function(h){var g=h.message;if(!g){g=h}else{if(h.number){g+=" ("+h.number+")"}}return g}}function getSignErrorMessage(b){var a;switch(b){case"NO_PLUGIN":a=SIGNER_NO_PLUGIN;break;case"NO_CERTS":a=SIGNER_CERT_LIST_EMPTY;break;case"CERTS_ERROR":a=SIGNER_CERT_ERROR;break;case"STORE_INIT_ERROR":a=SIGNER_STORE_INIT_ERROR;break;case"STORE_OPEN_ERROR":a=SIGNER_STORE_OPEN_ERROR;break;case"CREATE_SIGNER_ERROR":a=SIGNER_CREATE_SIGNER_ERROR;break;case"CREATE_OBJECT_ERROR":a=SIGNER_CREATE_OBJECT_ERROR;break;case"NO_CERT_CHOOSEN":a=SIGNER_CHOOSE_CERT;break;case"INIT_ERROR":a=SIGNER_INIT_ERROR;break;case"CERTIFICATE_OUT_OF_DATE":a=SIGNER_CERT_OUT_OF_DATE;break;case"SIGN_ERROR":default:a=SIGNER_SIGN_ERROR;break}return a};